<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="https://oss.kherrisan.cn/logo.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="正在从科瑞杉的折越节点向艾尔地表投放部队">
  <meta name="author" content="Kherrisan">
  <meta name="keywords" content>
  <title>Orange'S——学习笔记 - Kherrisan</title>

  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css">


  <link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css">
  <link rel="stylesheet" href="/lib/hint/hint.min.css">

  
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/solarized-light.min.css">
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link rel="stylesheet" href="/css/main.css">

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="//at.alicdn.com/t/font_1807639_npkndad6rc.css">



  <script src="/js/utils.js"></script>
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/rss2.xml" title="Kherrisan" type="application/rss+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/"> <strong>Kherrisan</strong> </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/posts/a2c247c4/">
                <i class="iconfont iconserver1"></i>
                项目
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/posts/fcad8979/">
                <i class="iconfont icon-user-fill"></i>
                留言板
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">  <i class="iconfont icon-search"></i>  </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax="true" style="background: url('/images/default.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2018-08-18 21:47">
      2018年8月18日 晚上
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      2.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      30
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <p>由于时间关系，不能够跟着书的进度自己一点点动手写出一个操作系统，因此想着先把书的内容过一遍，只要了解到OS底层运作思路即可。Orang’S下文简称为OS。</p>
<p>启动和加载</p>
<a id="more"></a>
<p>=====</p>
<p>OS的启动和加载主要分为三个阶段。</p>
<ol>
<li>BIOS检查外部存储设备并加载boot模块。</li>
<li>boot模块从外部存储设备搜索并加载loader模块。</li>
<li>loader模块从外部存储设备搜索并加载kernel模块。运行kernel.bin，正式进入系统。</li>
</ol>
<p>由于BIOS对boot模块的大小有限制，只能有512字节，因此启动过程中的大部分操作都在loader中进行。</p>
<h2 id="Boot"><a href="#Boot" class="headerlink" title="Boot"></a>Boot</h2><p>Boot是最先被读取并被加载进入内存的部分，根据约定，Boot不能超过512字节，且最后两个字节作为引导记录的标志，必须为0xaa55，这样BIOS才能识别的到。在OS中，boot、loader、kernel都是存放在floppy中的，为了方便写入文件，并且降低搜索文件和加载文件的复杂度，loader和kernel都是作为普通的文件写入floppy，而floppy被预格式化为了FAT12文件系统，这样boot只要按照读写FAT12文件系统的逻辑运行就可以读到loader和kernel。</p>
<p>Boot流程：</p>
<ol>
<li>软驱复位</li>
<li>在根目录区，逐个读取条目，比对文件名，直到找到Loader.bin所在的扇区号（开始簇号）。</li>
<li>在FAT表1，根据开始扇区号，读取该扇区在FAT表中的条目（簇号），读取该簇号对应扇区的文件。</li>
<li>根据簇号读取该簇号（扇区号）在FAT表中的条目（另一个簇号），重复读取这样的链式结构，直到某个条目的簇号为结束标志符。</li>
<li>跳转到Loader的入口代码处，交出控制权。</li>
</ol>
<h2 id="FAT12文件系统"><a href="#FAT12文件系统" class="headerlink" title="FAT12文件系统"></a>FAT12文件系统</h2><p>FAT12文件系统将存储空间分为四块：引导区，FAT表1和FAT表2，根目录区，用户数据区。</p>
<p><img src="https://oss.kherrisan.cn/Snipaste_2018-08-18_18-42-39.png" srcset="/img/loading.gif" alt></p>
<p>在FAT文件表中，每个条目占12位（一个半字节），条目所在位置或者说条目在表中的索引为该扇区簇号，条目内容为该文件下一部分簇号。</p>
<h2 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h2><p>Loader的功能如下：</p>
<ol>
<li>通过BIOS的15号中断（SMAP）读取总的内存空间大小。</li>
<li>以和Boot相同的方式，在floppy中定位到kernel.bin所在的位置，并加载到内存中。</li>
<li>启动保护模式的一系列操作：关中断，打开A20地址线，修改cr0寄存器的值，跳转到32位代码段。从此正式进入保护模式。</li>
<li>根据之前读到的内存空间大小，初始化足够的页目录和页表。</li>
<li>由于kernel.bin是ELF格式的，因此要重整kernel.bin在内存中的数据。</li>
<li>将控制权交给内核。</li>
</ol>
<p>Loader将内存组织为下面这样子：</p>
<p><img src="https://oss.kherrisan.cn/Snipaste_2018-08-19_10-40-31.png" srcset="/img/loading.gif" alt></p>
<h2 id="ELF文件格式"><a href="#ELF文件格式" class="headerlink" title="ELF文件格式"></a>ELF文件格式</h2><p>ELF是一种文件格式约定。对象文件有三类：</p>
<ol>
<li>可重定位文件。也就是.o文件。一个或多个.o文件可以被归档为一个静态库文件。</li>
<li>可执行文件。</li>
<li>可被共享文件。也就是.so动态库文件。</li>
</ol>
<p><img src="https://oss.kherrisan.cn/Snipaste_2018-08-19_11-45-09.png" srcset="/img/loading.gif" alt></p>
<p>上图中左侧为链接视图，右侧为运行视图。链接过程中以section为单位，运行过程中以segment为单位。整个文件可以分为4部分：</p>
<ol>
<li>ELF头部</li>
<li>program header table（程序头部表）</li>
<li>sections\segments</li>
<li>section header table（节头部表）</li>
</ol>
<p>ELF头部结构如下：</p>
<p>typedef struct {<br>    unsigned char e_ident[EI_NIDENT];     //一个数组，数组内容包括：魔数、32位/64位、大端/小端、文件版本等。<br>    ELF32_Half e_type;             //文件类型，可执行文件或者可重定向文件或者可共享文件<br>    ELF32_Half e_machine;             //架构<br>    ELF32_Word e_version;             //<br>    ELF32__Addr e_entry;             //可执行程序入口点地址<br>    ELF32_Off e_phoff;             //程序头部表地址<br>    ELF32_Off e_shoff;             //节头部表地址<br>    ELF32_Word e_flags;<br>    ELF32_Half e_ehsize;             //ELF头部大小<br>    ELF32_Half e_phentsize;         //程序头部表单个表项大小<br>    ELF32_Half e_phnum;             //程序头部表表项个数<br>    ELF32_Half e_shentsize;         //节头部表单个表项大小<br>    ELF32_Half e_shnum;             //节头部表表项个数<br>    ELF32_Half e_shstrndx;             //名称表的位置<br>}Elf32_Ehdr;</p>
<p>程序头部表结构如下：</p>
<p>typedef struct{<br>    Elf32_Word p_type;<br>    Elf32_Off p_offset;                //段相对于文件的偏移地址<br>    Elf32_Addr p_vaddr;                //段在内存中的虚拟地址<br>    Elf32_Addr p_paddr;                //段的物理地址<br>    Elf32_Word p_filesz;            //段在文件中的长度<br>    Elf32_Word p_memsz;                //段在内存中的长度<br>    Elf32_Word p_flage;<br>    Elf32_Word p_align;                //字节对齐<br>} Elf32_phdr;</p>
<p>节头部表的结构如下：</p>
<p>typedef struct{<br>    Elf32_Word sh_name;<br>    Elf32_Word sh_type;                //节区类型：程序定义、符号表、字符串表、重定位表等<br>    Elf32_Word sh_flags;<br>    Elf32_Addr sh_addr;<br>    Elf32_Off sh_offset;<br>    Elf32_Word sh_size;<br>    Elf32_Word sh_link;<br>    Elf32_Word sh_info;<br>    Elf32_Word sh_addralign;<br>    Elf32_Word sh_entsize;<br>}Elf32_Shdr;</p>
<p>常见系统节区：</p>
<ol>
<li>字符串表。类似于JVM字节码文件的常量表。只负责定义常量，其他地方如果要用到某个字符串常量只要通过索引即可。一般会有一个或者多个字符串表。</li>
<li>符号表。符号表格式相对复杂，每个符号表项约定了该符号的名字、值（某个具体值或者函数地址）、占用大小、可见性、类型（函数、变量、外部文件、某个节区）</li>
<li>代码段（.text）。符号表中会有字段指向代码段中的某个位置，来表示函数的代码。</li>
<li>全局偏移表（.got）。为了使得对全局变量的有效引用不依赖于实际的地址空间，因此为全局符号（静态函数或者变量）提供一个偏移量表。</li>
<li>过程链接表（.plt）。</li>
<li>哈希表。</li>
<li>数据段（.data .bss .rodata）。</li>
</ol>
<h1 id="段页式存储"><a href="#段页式存储" class="headerlink" title="段页式存储"></a>段页式存储</h1><p>逻辑地址经过分段转换变为线性地址，线性地址经过分页转换变为物理地址。段式存储是从逻辑上对内存的区域进行划分，以求对区域内内存的保护和管理，页式存储是从空间上对内存空间进行等分映射，目的在于控制内存分配粒度（外碎片）、虚拟地址空间。</p>
<h2 id="分段"><a href="#分段" class="headerlink" title="分段"></a>分段</h2><p>x86段表也成描述符表，有全局（GDT）和局部（LDT）两种描述符表，全局描述符表由内核管理，局部描述符表由进程管理。描述符表能够介入实模式中“段基址+段内偏移”的直接寻址模式，是一个中间步骤。</p>
<p>x86的段表项的结构如下：</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>每个表项占8个字节，其中占字节位数最多的是base和limit，由于某些历史上的原因，base和limit各自都不是连续地存放在表项中的。</p>
<ul>
<li>段基址共32位，4G，表示段的起点位置。</li>
<li>段界限共20位，表示段的长度，单位取决于G字段（1Byte或者4KByte）。</li>
<li>S为表示系统段、数据段。</li>
<li>DPL表示特权级，0、1、2、3。</li>
<li>P表示该段是否在内存中，和页表项的P位类似。</li>
<li>AVL位保留字段。</li>
<li>DB表示段的默认操作尺寸：16bit或者32bit。</li>
</ul>
<p>要引用某个段表项时，只需要指定段表项相对于表头的索引，即索引加1对应内存地址加8。索引不是数字，而是段选择子（selector）。段选择子的格式如下：</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-1.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<ul>
<li>一个selector占16位。</li>
<li>高13位用于索引段表项。Index加1的话整个选择子的值增加8，正好对应每个段表项8个字节的特性。</li>
<li>TI位用于区分是GDT还是LDT。</li>
<li>RPL表示特权级，0、1、2、3。</li>
</ul>
<p>真正使用时，将选择子放入段寄存器中（CS、DS、SS等），硬件就会自动通过选择子找到对应的段表项，取得段表项的基址和界限，确认逻辑地址的段内偏移在界限内之后，通过基址+段内偏移得到线性地址。</p>
<p>系统通过GDTR寄存器来找到GDT的位置。</p>
<p>LDT相当于GDT的后级段表。</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-2.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>LDTR寄存器存放某个选择子，系统会根据该选择子从GDT中选择某个段，然后将该段的基址和界限内的内存空间视为一张LDT，通过逻辑地址SELECTOR:OFFSET的SELECTOR选择段表项，通过OFFSET得到具体的线性地址。</p>
<p>使用LDT的好处是，只需要切换LDTR，就可以让相同的逻辑地址指向不同的线性地址。</p>
<h2 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h2><p>OS中使用页目录——页表组成的二级页表结构来将线性地址转换为物理地址。</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-3.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>页目录项和页表项的结构大致相同：</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-4.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<ul>
<li>Avail保留。</li>
<li>G位表示全局页，全局页表示当CR3加载时，该页目录项或者页表项也是有效的。</li>
<li>D位表示脏位。</li>
<li>A位表示是否被访问过。</li>
<li>PCD位表示单个页或者页表是否可以被缓冲。</li>
<li>U/S位表示特权级，与CPL（CR0中的WP位）一起共同控制读写权限。</li>
<li>R/W位表示读写权限，与CPL（CR0中的WP位）一起控制读写权限。</li>
<li>P位表示是否存在于内存中。如果不存在，会产生页错误。</li>
</ul>
<p>注意：多个页表并不需要连续存放，页表可以存在于内存中的任何位置。</p>
<p>系统通过CR3寄存器获得页目录基址。</p>
<h2 id="TSS（任务状态段）"><a href="#TSS（任务状态段）" class="headerlink" title="TSS（任务状态段）"></a>TSS（任务状态段）</h2><p>TSS可以看做一张表。</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-5.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>TSS的用户：</p>
<ul>
<li>保存ring0、ring1、ring2的栈顶和堆栈段选择子。</li>
<li>通过JMP+TSS段选择子，可以一次性切换一堆寄存器（先保存当前寄存器值到TR指定的TSS，再用新的TSS中的寄存器值替换寄旧值）。GDT中可以存放多个TSS，引用TSS同样需要使用selector。</li>
</ul>
<p>据说设计TSS的初衷就是为了方便任务切换，但由于效率太低，因此已经被启弃用了。</p>
<h1 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h1><p>中断本质上是一种事件处理机制。</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-9.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-6.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>OS保护模式下的中断的处理机制如下：</p>
<ol>
<li>由外部设备或者CPU产生触发中断，硬件会根据中断号在中断描述符表（IDT）中选择一个表项，IDT中存放的表项成为门描述符，有3种：中断门、陷阱门、任务门。</li>
<li>取出门描述符后，会进行一些检查：limit检查、权限检查。</li>
<li>从门描述符中读取段表选择子，判断是LDT还是GDT（依靠TI位）。</li>
<li>根据选择子从段表中读取代码段描述符，会进行一些检查：limit检查，权限检查。</li>
<li>段描述符的base+门描述符的offset得到中断处理程序的地址。</li>
</ol>
<p>x86提供了一些预制的中断和中断向量号。这些预制的中断能够保证在该事件发生时，硬件会根据中断向量号去调取相应的门描述符，但门描述符的内容需要操作系统自己去设置。还可以使用8259来处理新的外部中断。</p>
<p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-8.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<p>x86在进入中断处理程序之前，会把eflags、cs、eip、errorcode压栈，便于中断处理程序结束之后回到中断现场。</p>
<h1 id="保护模式"><a href="#保护模式" class="headerlink" title="保护模式"></a>保护模式</h1><p><img src="https://www.dokyme.cn/wp-content/uploads/2018/08/NewImage-10.png" srcset="/img/loading.gif" alt="NewImage" title="NewImage.png"></p>
<h1 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h1>
            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/OS/">OS</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/OS/">OS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/posts/2b8650f6/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Linux——进程管理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/posts/e6be9c71/">
                        <span class="hidden-mobile">Spring——IOC流程概述</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    function loadValine() {
      addScript('https://cdn.staticfile.org/valine/1.4.14/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "1AGA0PAY5WWIJSD1Pwy5SKf4-9Nh9j0Va",
          app_key: "yMd3tsz0IrFw5tuKWGhQiehm",
          placeholder: "找个位子随便坐",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: true,
          serverURLs: "kherrisan.cn",
        });
      });
    }
    createObserver(loadValine, 'vcomments');
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://valine.js.org" target="_blank" rel="nofollow noopener noopener">comments
      powered by Valine.</a></noscript>


              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i> 目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  
    <!-- APlayer 音乐播放器 -->
    <div id="aplayer"></div>
    <script defer src="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/aplayer/1.10.1/APlayer.min.css">
<script type="text/javascript">
  var oldLoadAp = window.onload;
  window.onload = function () {
    oldLoadAp && oldLoadAp();

    new APlayer({
      container: document.getElementById('aplayer'),
      fixed: true,
      autoplay: 'false' === 'true',
      loop: 'all',
      order: 'random',
      theme: '#b7daff',
      preload: 'none',
      audio: [{"name":"竈門炭治郎のうた","artist":"椎名豪","url":"https://oss.kherrisan.cn/tanjiro.mp3","cover":" https://oss.kherrisan.cn/20200509135933.jpg"}]
    });
  }
</script>

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


    
  <!-- 备案信息 -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">苏ICP备17065958号-2</a>
    
      <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=32040202000292" rel="nofollow noopener" class="beian-police" target="_blank">
        <span class="beian-police-sep"> | </span>
        
          <img src="/images/police_beian.png" srcset="/img/loading.gif" alt="police-icon">
        
        <span>苏公网安备32040202000292号</span>
      </a>
     
  </div>


    
  </div>
</footer>

<!-- SCRIPTS -->
<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
<script src="/js/debouncer.js"></script>
<script src="/js/main.js"></script>

<!-- Plugins -->


  
    <script src="/js/lazyload.js"></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>
  <script src="/js/clipboard-use.js"></script>







  <script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Orange'S——学习笔记&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js"></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css">

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  











  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?fc9d623078759986f2e5bb403ec93fa7";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'G-MC0BRNCVCQ', 'auto');
      ga('send', 'pageview');
    </script>
  

  

  

  

  





</body>
</html>
